# Twitter 图片爬虫 (Twitter_Crawler)

这是一个功能强大的Twitter（现X平台）图片爬虫工具，支持按标签和时间范围爬取图片、视频和GIF。(目前暂时只支持图片爬取)

**有效时间：截止到2025/07/05可正常使用，由于x会不定时变换页面，故若爬虫失效，请针对查找页面元素的代码进行修改即可**

## 主要功能

- 🔍 按标签（tag）搜索并下载内容
- 📅 支持设置时间范围过滤
- 🖼️ 支持下载图片、视频和GIF（视频和GIF功能待完善）
- ❤️ 支持按热度（点赞数）爬取内容
- 📝 自动生成下载日志
- 🔗 保存所有下载内容的原始链接
- 🔄 支持连续运行多次爬虫任务而不需要重启程序

## 环境要求

- Python 3.6+
- Chrome浏览器
- ChromeDriver（已包含在项目中）
- 依赖的Python库:
  - selenium 4.15.2+
  - requests 2.31.0+
  - termcolor 2.3.0+
  - tenacity 8.2.2+
  - urllib3 2.0.0+
  - datetime 5.0+
  - PyQt6 6.4.0+
  - psutil 5.9.0+ (新增依赖，用于浏览器资源管理)

## 安装步骤

1. 克隆项目到本地
```bash
git clone [项目地址]
cd twitter_Crawler
```

2. 安装依赖包
```bash
pip install -r requirements.txt
```

## 源码使用说明

### 1. 配置Cookie

首次使用需要获取Twitter的登录Cookie：

1. 运行Cookie设置脚本：
```bash
python set_cookie.py
```

2. 在打开的浏览器窗口中登录Twitter（90秒内完成）
3. 等待浏览器自动关闭，Cookie将保存为`X_cookie.json`

注意：请勿手动关闭浏览器，否则可能导致Cookie获取失败

### 2. 配置爬虫参数

在`config.py`中设置以下参数：

- `tag`：要爬取的标签（不需要加#）
- `user_choice`：下载内容类型（1:图片，2:视频，3:GIF，123:全部）
- `late_time`：页面滚动延迟时间（建议5-10秒）
- `date_flag`：是否启用时间范围过滤
- `start_time`：开始时间（格式：YYYY-MM-DD）
- `end_time`：结束时间（格式：YYYY-MM-DD）
- `urls_num`：按热度爬取时的推文数量

### 3. 运行爬虫

执行主程序：
```bash
python main.py
```

程序会同时启动两个爬虫线程：
- Twitter爬虫：按时间顺序爬取内容
- 热度爬虫：按点赞数爬取内容

**重要更新**：现在支持连续运行多次爬虫任务而不需要退出程序。两次爬虫运行之间会自动清理浏览器资源，确保每次爬取都有一个干净的环境。

### 4. 输出结果

所有结果将保存在以下格式的文件夹中：
```
result_[标签名]_[时间戳]/
├── time_crawler_result/    # 按时间顺序爬取的结果
│   ├── 图片文件
│   ├── video & gif/          # 视频和GIF文件夹
│   ├── download_log.txt      # 下载日志
│   └── image.txt             # 图片链接文件
└── hot_crawler_result/   # 按热度爬取的结果
    ├── 图片文件
    ├── [标签名]_dianzan_log.txt
    └── image.txt
```

## 直接运行说明

**如果不想使用源码而是直接运行，找到dist/Twitter爬虫.exe并运行**

1. 请先点击获取cookie按钮，获取cookie（注意：请尽快登录，登录时间为90秒，登录成功后等待自动关闭不要手动关闭）
2. 获取cookie后，请正确填写配置并点击保存配置按钮，保存配置
3. 点击开始爬取按钮，开始爬取数据
4. 开始下一次爬取时，如果配置不变则直接点击开始爬取按钮，如果配置改变则先点击保存配置按钮，再点击开始爬取按钮
5. 如果不需要切换账号，那么cookie是可以一直使用的

## 软件截图



## 注意事项

1. 由于Twitter页面是动态加载的，程序使用Selenium模拟浏览器操作，请确保网络连接稳定
2. 下载使用线程锁控制，默认同时下载10张图片和3个视频，可在`download_method.py`中调整`video_connections`和`img_connections`的值
3. 时间范围过滤仅在标签搜索页面有效，用户主页由于有置顶功能可能导致过滤异常
4. 如果爬虫失效，请先检查Twitter页面元素是否更新
5. 支持优雅退出，按Ctrl+C可安全停止爬虫
6. 多次连续运行爬虫时，会自动清理浏览器资源，无需手动关闭程序重新启动

## 开发说明

- 项目使用Selenium进行页面操作
- 使用多线程处理并发下载
- 实现了断点续传功能
- 包含详细的日志记录
- 内置浏览器资源清理机制，确保连续运行稳定性

## 最近更新（问题及修改）

- **2025/07/08**: 修复连续运行爬虫时，time模块无法正常运行的问题
  - 添加浏览器状态重置功能，确保每次爬取都有一个干净的环境
  - 改进浏览器资源清理机制，解决浏览器实例残留问题
  - 增强帖子处理逻辑，提高爬取成功率
  - 新增依赖：psutil库，用于更有效地管理浏览器进程
- **2025/07/08**:  mac上运行源码ui界面正常可以更新配置，使用pyinstaller在Windows上打包exe文件时修改配置文件后，无法正常更新配置文件，会沿用之前的配置进行爬取，内存未重新刷新

## 许可证

本项目使用的ChromeDriver遵循[LICENSE.chromedriver](LICENSE.chromedriver)。

## 贡献

欢迎提交Issue和Pull Request来帮助改进项目。